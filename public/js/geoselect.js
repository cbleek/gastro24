!function(s){function c(t){return t.loading||"object"!=typeof t.data?t.text:"<strong>"+e(t.data)+"</strong><br /><small>"+t.data.region+"</small>"}function l(t){return t.id&&"object"==typeof t.data?e(t.data):t.text}function e(t){var e="";return"Bundesland"==t.city&&(t.city="Kanton "+t.region),t.postalCode&&(e+=t.postalCode+" "),e+=t.city}s.fn.geoSelect=function(){return this.each(function(){var t=s(this);t.data("geoSelectInitialized")||(t.data("geoSelectInitialized",!0),function(e){e.select2({theme:"bootstrap",width:e.data("width"),placeholder:e.data("placeholder"),minimumInputLength:2,tags:!0,ajax:{url:basePath+"/",dataType:"json",delay:250,data:function(t){return{q:t.term,ajax:"geo",lang:lang}},processResults:function(t,e){return console.debug("processResults: results:",t),console.debug(s.map(t.items,function(t){return{id:JSON.stringify(t),data:t}})),{results:s.map(t.items,function(t){return"Bundesland"==t.city&&(t.city="Kanton "+t.region),{id:JSON.stringify(t),data:t}}),pagination:{more:!1}}}},createTag:function(t){var e=s.trim(t.term);return""===e?null:{id:JSON.stringify({city:e,postalCode:"",region:""}),text:e,data:{city:e,postalCode:"",region:""}}},templateResult:c,templateSelection:l,escapeMarkup:function(t){return t}});var n=e.data("val");if(n?s.isArray(n)||(n=[n]):n=[],n.length){for(var a=n.length-1;0<=a;--a){try{var r=JSON.parse(n[a])}catch(t){r=n[a]}var t=r.city;"Bundesland"==t&&(t="Kanton "+r.region);var i=s("<option selected>"+t+"</option>");i.val(JSON.stringify(r));var o=n[a];"string"==typeof data&&(o=JSON.parse(o)),i.text(l({id:n[a],data:o})),e.prepend(i)}e.trigger("change")}e.parents("form").on("reset.geoselect",function(t){window.setTimeout(function(){e.val("").trigger("change")},10)})}(t))})},s(function(){s("select.geoselect").geoSelect()})}(jQuery);